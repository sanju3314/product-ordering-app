<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Product Ordering System</title>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.4.1/papaparse.min.js"></script>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen', 'Ubuntu', 'Cantarell', sans-serif;
        }
    </style>
</head>
<body>
    <div id="root"></div>
    
    <script type="text/babel">
        const { useState, useEffect, useRef } = React;
        
        // Lucide React icons as inline SVG components
        const Upload = ({ size = 24, className = "" }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
                <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
                <polyline points="7,10 12,15 17,10"/>
                <line x1="12" y1="15" x2="12" y2="3"/>
            </svg>
        );
        
        const Download = ({ size = 24, className = "" }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
                <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
                <polyline points="17,8 12,13 7,8"/>
                <line x1="12" y1="2" x2="12" y2="13"/>
            </svg>
        );
        
        const ArrowRight = ({ size = 24, className = "" }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
                <line x1="5" y1="12" x2="19" y2="12"/>
                <polyline points="12,5 19,12 12,19"/>
            </svg>
        );
        
        const ArrowLeft = ({ size = 24, className = "" }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
                <line x1="19" y1="12" x2="5" y2="12"/>
                <polyline points="12,19 5,12 12,5"/>
            </svg>
        );
        
        const Check = ({ size = 24, className = "" }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
                <polyline points="20,6 9,17 4,12"/>
            </svg>
        );
        
        const FileText = ({ size = 24, className = "" }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
                <path d="M14,2H6a2 2 0 0 0-2 2V20a2 2 0 0 0,2 2H18a2 2 0 0 0,2-2V8z"/>
                <polyline points="14,2 14,8 20,8"/>
                <line x1="16" y1="13" x2="8" y2="13"/>
                <line x1="16" y1="17" x2="8" y2="17"/>
                <polyline points="10,9 9,9 8,9"/>
            </svg>
        );

        const User = ({ size = 24, className = "" }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
                <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/>
                <circle cx="12" cy="7" r="4"/>
            </svg>
        );

        const Phone = ({ size = 24, className = "" }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
                <path d="M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z"/>
            </svg>
        );

        const MapPin = ({ size = 24, className = "" }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
                <path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"/>
                <circle cx="12" cy="10" r="3"/>
            </svg>
        );

        const Calendar = ({ size = 24, className = "" }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
                <rect x="3" y="4" width="18" height="18" rx="2" ry="2"/>
                <line x1="16" y1="2" x2="16" y2="6"/>
                <line x1="8" y1="2" x2="8" y2="6"/>
                <line x1="3" y1="10" x2="21" y2="10"/>
            </svg>
        );

        const Package = ({ size = 24, className = "" }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
                <line x1="16.5" y1="9.4" x2="7.5" y2="4.21"/>
                <path d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z"/>
                <polyline points="3.27,6.96 12,12.01 20.73,6.96"/>
                <line x1="12" y1="22.08" x2="12" y2="12"/>
            </svg>
        );

        const DollarSign = ({ size = 24, className = "" }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
                <line x1="12" y1="1" x2="12" y2="23"/>
                <path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"/>
            </svg>
        );

        const ChevronLeft = ({ size = 24, className = "" }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
                <polyline points="15,18 9,12 15,6"/>
            </svg>
        );

        const ChevronRight = ({ size = 24, className = "" }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
                <polyline points="9,18 15,12 9,6"/>
            </svg>
        );

        const ShoppingCart = ({ size = 24, className = "" }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
                <circle cx="9" cy="21" r="1"/>
                <circle cx="20" cy="21" r="1"/>
                <path d="M1 1h4l2.68 13.39a2 2 0 0 0 2 1.61h9.72a2 2 0 0 0 2-1.61L23 6H6"/>
            </svg>
        );

        const ProductOrderingApp = () => {
          const [currentStep, setCurrentStep] = useState(1);
          const [customerData, setCustomerData] = useState({
            date: new Date().toISOString().split('T')[0],
            customerName: '',
            customerMobile: '',
            city: '',
            pincode: ''
          });
          
          const [products, setProducts] = useState([]);
          const [categories, setCategories] = useState([]);
          const [currentCategory, setCurrentCategory] = useState(0);
          const [uploadedCSV, setUploadedCSV] = useState(null);
          const [orderData, setOrderData] = useState({});
          const [orderSummary, setOrderSummary] = useState({ totalItems: 0, totalValue: 0 });
          const [showCSVPreview, setShowCSVPreview] = useState(false);
          const [csvContent, setCsvContent] = useState('');
          const fileInputRef = useRef(null);

          // Calculate totals whenever orderData or products change
          useEffect(() => {
            let totalItems = 0;
            let totalValue = 0;
            
            Object.keys(orderData).forEach(childSKU => {
              const quantity = orderData[childSKU];
              if (quantity && quantity > 0) {
                const product = products.find(p => p['Child SKU Code'] === childSKU);
                if (product) {
                  totalItems += quantity;
                  totalValue += quantity * parseFloat(product.WSP || 0);
                }
              }
            });
            
            setOrderSummary({ totalItems, totalValue: totalValue.toFixed(2) });
          }, [orderData, products]);

          // Handle CSV upload
          const handleCSVUpload = (event) => {
            const file = event.target.files[0];
            if (!file) return;

            Papa.parse(file, {
              header: true,
              dynamicTyping: true,
              skipEmptyLines: true,
              complete: (results) => {
                // Clean headers by trimming whitespace
                const cleanedData = results.data.map(row => {
                  const cleanedRow = {};
                  Object.keys(row).forEach(key => {
                    const cleanKey = key.trim();
                    cleanedRow[cleanKey] = row[key];
                  });
                  return cleanedRow;
                }).filter(row => row['Child SKU Code']); // Filter out empty rows
                
                setProducts(cleanedData);
                const uniqueCategories = [...new Set(cleanedData.map(item => item.Category))].filter(Boolean);
                setCategories(uniqueCategories);
                setUploadedCSV(file.name);
                alert('✅ Products loaded successfully!');
              },
              error: (error) => {
                alert('❌ Error uploading file: ' + error.message);
              }
            });
            
            // Reset file input
            event.target.value = '';
          };

          // Group products by parent SKU and variant
          const groupProductsByParentAndVariant = (categoryProducts) => {
            const grouped = {};
            
            categoryProducts.forEach(product => {
              const parentSKU = product['Parent SKU Code'];
              const childSKU = product['Child SKU Code'];
              
              // Extract variant from positions 9-11 of child SKU (or use color as fallback)
              let variant;
              if (childSKU && childSKU.length > 11) {
                variant = childSKU.substring(9, 12);
              } else {
                variant = product.Color || 'DEFAULT';
              }
              
              const key = `${parentSKU}_${variant}`;
              
              if (!grouped[key]) {
                grouped[key] = {
                  parentSKU,
                  variant,
                  color: product.Color,
                  category: product.Category,
                  mrp: product.MRP,
                  imageUrl: product['Image URL'],
                  hsn: product.HSN,
                  sizes: []
                };
              }
              
              grouped[key].sizes.push({
                size: product.Size,
                childSKU: product['Child SKU Code'],
                wsp: product.WSP
              });
            });
            
            return Object.values(grouped);
          };

          // Handle quantity changes
          const handleQuantityChange = (childSKU, quantity) => {
            setOrderData(prev => {
              const newData = { ...prev };
              const qty = quantity === '' ? 0 : parseInt(quantity) || 0;
              
              if (qty <= 0) {
                delete newData[childSKU];
              } else {
                newData[childSKU] = qty;
              }
              
              return newData;
            });
          };

          // Generate CSV download
          const generateCSV = () => {
            const orderEntries = Object.keys(orderData).filter(childSKU => orderData[childSKU] > 0);
            
            if (orderEntries.length === 0) {
              alert('⚠️ No products selected for order. Please select quantities before downloading.');
              return;
            }

            const orderRows = orderEntries.map(childSKU => {
              const quantity = orderData[childSKU];
              const product = products.find(p => p['Child SKU Code'] === childSKU);
              
              if (!product) return null;
              
              const totalValue = (quantity * parseFloat(product.WSP || 0)).toFixed(2);
              return {
                'Date': customerData.date,
                'Customer Name': customerData.customerName,
                'Customer Mobile': customerData.customerMobile,
                'City': customerData.city,
                'Pincode': customerData.pincode,
                'Parent SKU Code': product['Parent SKU Code'],
                'Child SKU Code': product['Child SKU Code'],
                'Color': product.Color,
                'Size': product.Size,
                'Category': product.Category,
                'MRP': product.MRP,
                'WSP': product.WSP,
                'HSN': product.HSN,
                'Order Qty': quantity,
                'Total Price': totalValue
              };
            }).filter(Boolean);

            try {
              const csv = Papa.unparse(orderRows);
              
              // Try to download (works in published environments)
              const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
              const link = document.createElement('a');
              const url = URL.createObjectURL(blob);
              link.href = url;
              link.download = `Order_${customerData.customerName.replace(/[^a-zA-Z0-9]/g, '_')}_${customerData.date}.csv`;
              
              document.body.appendChild(link);
              link.click();
              document.body.removeChild(link);
              URL.revokeObjectURL(url);
              
              alert('✅ Order exported successfully!');
            } catch (error) {
              console.error('Export error:', error);
              alert('❌ Error exporting order. Please try again.');
            }
          };

          // Get current category products
          const getCurrentCategoryProducts = () => {
            if (categories.length === 0) return [];
            const currentCat = categories[currentCategory];
            return products.filter(p => p.Category === currentCat);
          };

          const validateCustomerInfo = () => {
            const { customerName, customerMobile, city, pincode } = customerData;
            return customerName.trim() && customerMobile.trim() && city.trim() && pincode.trim();
          };

          const { totalItems, totalValue } = orderSummary;

          return (
            <div className="min-h-screen bg-gradient-to-br from-blue-50 via-purple-50 to-pink-50 p-4">
              <div className="max-w-6xl mx-auto">
                {/* Header with Progress Steps */}
                <div className="bg-white rounded-xl shadow-2xl p-8 mb-6 border border-gray-100">
                  <h1 className="text-4xl font-bold bg-gradient-to-r from-blue-600 to-purple-600 bg-clip-text text-transparent mb-6 text-center">
                    Product Catalog Management
                  </h1>
                  
                  {/* Progress Steps */}
                  <div className="flex items-center justify-center space-x-4 text-sm">
                    <div className={`flex items-center space-x-2 ${currentStep >= 1 ? 'text-blue-600' : 'text-gray-400'}`}>
                      <div className={`w-10 h-10 rounded-full flex items-center justify-center font-bold ${
                        currentStep >= 1 ? 'bg-blue-600 text-white' : 'bg-gray-300 text-gray-600'
                      } ${currentStep > 1 ? 'bg-green-500' : ''}`}>
                        {currentStep > 1 ? <Check size={20} /> : '1'}
                      </div>
                      <span className="font-medium">Customer Details</span>
                    </div>
                    
                    <ArrowRight size={20} className="text-gray-400" />
                    
                    <div className={`flex items-center space-x-2 ${currentStep >= 2 ? 'text-blue-600' : 'text-gray-400'}`}>
                      <div className={`w-10 h-10 rounded-full flex items-center justify-center font-bold ${
                        currentStep >= 2 ? 'bg-blue-600 text-white' : 'bg-gray-300 text-gray-600'
                      } ${currentStep > 2 ? 'bg-green-500' : ''}`}>
                        {currentStep > 2 ? <Check size={20} /> : '2'}
                      </div>
                      <span className="font-medium">Upload Catalog</span>
                    </div>
                    
                    <ArrowRight size={20} className="text-gray-400" />
                    
                    <div className={`flex items-center space-x-2 ${currentStep >= 3 ? 'text-blue-600' : 'text-gray-400'}`}>
                      <div className={`w-10 h-10 rounded-full flex items-center justify-center font-bold ${
                        currentStep >= 3 ? 'bg-blue-600 text-white' : 'bg-gray-300 text-gray-600'
                      }`}>
                        3
                      </div>
                      <span className="font-medium">Product Selection</span>
                    </div>
                  </div>
                </div>

                {/* Step 1: Customer Details */}
                {currentStep === 1 && (
                  <div className="bg-white rounded-xl shadow-2xl p-8 border border-gray-100">
                    <h2 className="text-2xl font-bold text-gray-800 mb-6 flex items-center">
                      <User className="w-6 h-6 mr-3 text-blue-600" />
                      Customer Information
                    </h2>
                    
                    <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                      <div>
                        <label className="block text-sm font-medium text-gray-700 mb-2 flex items-center">
                          <Calendar className="w-4 h-4 mr-2 text-blue-500" />
                          Date
                        </label>
                        <input
                          type="date"
                          value={customerData.date}
                          onChange={(e) => setCustomerData({...customerData, date: e.target.value})}
                          className="w-full p-4 border-2 border-gray-200 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all"
                        />
                      </div>
                      
                      <div>
                        <label className="block text-sm font-medium text-gray-700 mb-2 flex items-center">
                          <User className="w-4 h-4 mr-2 text-green-500" />
                          Customer Name *
                        </label>
                        <input
                          type="text"
                          value={customerData.customerName}
                          onChange={(e) => setCustomerData({...customerData, customerName: e.target.value})}
                          className="w-full p-4 border-2 border-gray-200 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent transition-all"
                          placeholder="Enter customer name"
                        />
                      </div>
                      
                      <div>
                        <label className="block text-sm font-medium text-gray-700 mb-2 flex items-center">
                          <Phone className="w-4 h-4 mr-2 text-orange-500" />
                          Mobile Number *
                        </label>
                        <input
                          type="tel"
                          value={customerData.customerMobile}
                          onChange={(e) => setCustomerData({...customerData, customerMobile: e.target.value})}
                          className="w-full p-4 border-2 border-gray-200 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-transparent transition-all"
                          placeholder="Enter mobile number"
                        />
                      </div>
                      
                      <div>
                        <label className="block text-sm font-medium text-gray-700 mb-2 flex items-center">
                          <MapPin className="w-4 h-4 mr-2 text-red-500" />
                          City *
                        </label>
                        <input
                          type="text"
                          value={customerData.city}
                          onChange={(e) => setCustomerData({...customerData, city: e.target.value})}
                          className="w-full p-4 border-2 border-gray-200 rounded-lg focus:ring-2 focus:ring-red-500 focus:border-transparent transition-all"
                          placeholder="Enter city"
                        />
                      </div>
                      
                      <div className="md:col-span-2">
                        <label className="block text-sm font-medium text-gray-700 mb-2 flex items-center">
                          <MapPin className="w-4 h-4 mr-2 text-purple-500" />
                          Pincode *
                        </label>
                        <input
                          type="text"
                          value={customerData.pincode}
                          onChange={(e) => setCustomerData({...customerData, pincode: e.target.value})}
                          className="w-full p-4 border-2 border-gray-200 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent transition-all"
                          placeholder="Enter pincode"
                        />
                      </div>
                    </div>
                    
                    <div className="mt-8 flex justify-end">
                      <button
                        onClick={() => {
                          if (validateCustomerInfo()) {
                            setCurrentStep(2);
                          } else {
                            alert('⚠️ Please fill in all customer details');
                          }
                        }}
                        disabled={!validateCustomerInfo()}
                        className={`px-8 py-4 rounded-lg font-bold text-lg transition-all transform hover:scale-105 flex items-center space-x-2 ${
                          validateCustomerInfo()
                            ? 'bg-gradient-to-r from-blue-600 to-purple-600 hover:from-blue-700 hover:to-purple-700 text-white shadow-lg'
                            : 'bg-gray-300 text-gray-500 cursor-not-allowed'
                        }`}
                      >
                        <span>Next Step</span>
                        <ArrowRight size={20} />
                      </button>
                    </div>
                  </div>
                )}

                {/* Step 2: Upload CSV */}
                {currentStep === 2 && (
                  <div className="bg-white rounded-xl shadow-2xl p-8 border border-gray-100">
                    <h2 className="text-2xl font-bold text-gray-800 mb-6 flex items-center">
                      <Upload className="w-6 h-6 mr-3 text-blue-600" />
                      Upload Product Catalog
                    </h2>
                    
                    <div className="border-2 border-dashed border-gray-300 rounded-xl p-12 text-center bg-gradient-to-br from-gray-50 to-gray-100">
                      <input
                        type="file"
                        accept=".csv"
                        onChange={handleCSVUpload}
                        ref={fileInputRef}
                        className="hidden"
                      />
                      
                      <div className="w-24 h-24 bg-gradient-to-r from-blue-500 to-purple-600 rounded-full flex items-center justify-center mx-auto mb-6">
                        <FileText size={40} className="text-white" />
                      </div>
                      
                      <h3 className="text-xl font-bold text-gray-800 mb-2">
                        {uploadedCSV ? `✅ Uploaded: ${uploadedCSV}` : 'Upload your product catalog CSV'}
                      </h3>
                      
                      <p className="text-gray-600 mb-6">
                        {uploadedCSV 
                          ? `${products.length} products loaded across ${categories.length} categories` 
                          : 'CSV should contain: Parent SKU Code, Child SKU Code, Color, Size, Category, MRP, WSP, Image URL, HSN'
                        }
                      </p>
                      
                      <button
                        onClick={() => fileInputRef.current?.click()}
                        className="bg-gradient-to-r from-blue-600 to-purple-600 hover:from-blue-700 hover:to-purple-700 text-white px-8 py-4 rounded-lg font-bold text-lg transition-all transform hover:scale-105 flex items-center space-x-2 mx-auto shadow-lg"
                      >
                        <Upload size={20} />
                        <span>{uploadedCSV ? 'Change File' : 'Upload CSV'}</span>
                      </button>
                    </div>
                    
                    {uploadedCSV && (
                      <div className="mt-8 flex justify-between">
                        <button
                          onClick={() => setCurrentStep(1)}
                          className="bg-gradient-to-r from-gray-500 to-gray-600 hover:from-gray-600 hover:to-gray-700 text-white px-6 py-3 rounded-lg font-medium transition-all flex items-center space-x-2"
                        >
                          <ArrowLeft size={16} />
                          <span>Back</span>
                        </button>
                        <button
                          onClick={() => setCurrentStep(3)}
                          className="bg-gradient-to-r from-blue-600 to-purple-600 hover:from-blue-700 hover:to-purple-700 text-white px-8 py-4 rounded-lg font-bold text-lg transition-all transform hover:scale-105 flex items-center space-x-2 shadow-lg"
                        >
                          <span>Start Ordering</span>
                          <ArrowRight size={20} />
                        </button>
                      </div>
                    )}
                  </div>
                )}

                {/* Step 3: Product Selection */}
                {currentStep === 3 && (
                  <div className="space-y-6">
                    {/* Category Navigation */}
                    <div className="bg-white rounded-xl shadow-lg p-6 border border-gray-100">
                      <div className="flex items-center justify-between mb-6">
                        <h2 className="text-2xl font-bold bg-gradient-to-r from-blue-600 to-purple-600 bg-clip-text text-transparent">
                          {categories[currentCategory]} Products
                        </h2>
                        <div className="flex items-center space-x-4">
                          <span className="text-sm text-gray-600 bg-gray-100 px-3 py-1 rounded-full">
                            Category {currentCategory + 1} of {categories.length}
                          </span>
                          <div className="flex gap-2">
                            <button
                              onClick={() => setCurrentCategory(Math.max(0, currentCategory - 1))}
                              disabled={currentCategory === 0}
                              className="bg-gradient-to-r from-blue-500 to-blue-600 hover:from-blue-600 hover:to-blue-700 text-white p-2 rounded-lg transition-all disabled:bg-gray-300"
                            >
                              <ChevronLeft size={20} />
                            </button>
                            <button
                              onClick={() => setCurrentCategory(Math.min(categories.length - 1, currentCategory + 1))}
                              disabled={currentCategory === categories.length - 1}
                              className="bg-gradient-to-r from-blue-500 to-blue-600 hover:from-blue-600 hover:to-blue-700 text-white p-2 rounded-lg transition-all disabled:bg-gray-300"
                            >
                              <ChevronRight size={20} />
                            </button>
                          </div>
                        </div>
                      </div>
                      
                      <div className="flex flex-wrap gap-2">
                        {categories.map((category, index) => (
                          <button
                            key={index}
                            onClick={() => setCurrentCategory(index)}
                            className={`px-4 py-2 rounded-lg font-medium transition-all transform hover:scale-105 ${
                              currentCategory === index
                                ? 'bg-gradient-to-r from-purple-500 to-purple-600 text-white shadow-lg'
                                : 'bg-gray-100 hover:bg-gray-200 text-gray-700'
                            }`}
                          >
                            {category}
                          </button>
                        ))}
                      </div>
                    </div>

                    {/* Products Grid - 2 per row */}
                    <div className="grid grid-cols-1 lg:grid-cols-2 gap-6">
                      {groupProductsByParentAndVariant(getCurrentCategoryProducts()).map((productGroup, index) => (
                        <div key={index} className="bg-white rounded-xl shadow-lg p-6 border-2 border-gray-100 hover:border-purple-300 transition-all">
                          <div className="flex items-start space-x-4">
                            <div className="flex-shrink-0">
                              <img
                                src={productGroup.imageUrl || 'https://images.unsplash.com/photo-1441986300917-64674bd600d8?w=400&h=400&fit=crop'}
                                alt={productGroup.parentSKU}
                                className="w-24 h-24 object-cover rounded-lg border-2 border-gray-200"
                                onError={(e) => {
                                  if (e.target.src !== 'https://images.unsplash.com/photo-1503919545889-aef636e10ad4?w=400&h=400&fit=crop') {
                                    e.target.src = 'https://images.unsplash.com/photo-1503919545889-aef636e10ad4?w=400&h=400&fit=crop';
                                  } else {
                                    e.target.src = 'https://images.unsplash.com/photo-1515372039744-b8f02a3ae446?w=400&h=400&fit=crop';
                                  }
                                }}
                              />
                            </div>
                            
                            <div className="flex-1">
                              <h3 className="font-bold text-lg bg-gradient-to-r from-blue-600 to-purple-600 bg-clip-text text-transparent">
                                {productGroup.parentSKU}
                              </h3>
                              <p className="text-sm text-gray-600">Color: {productGroup.color}</p>
                              <p className="text-sm text-gray-600">Variant: {productGroup.variant}</p>
                              <p className="text-sm font-medium text-red-600">MRP: ₹{productGroup.mrp}</p>
                              
                              <div className="mt-4 space-y-2">
                                <h4 className="font-medium text-gray-800">Available Sizes:</h4>
                                {productGroup.sizes.map((sizeInfo, sizeIndex) => {
                                  const currentQty = orderData[sizeInfo.childSKU] || 0;
                                  const lineTotal = currentQty * parseFloat(sizeInfo.wsp || 0);
                                  
                                  return (
                                    <div key={sizeIndex} className="flex items-center justify-between bg-gradient-to-r from-gray-50 to-gray-100 p-3 rounded-lg border border-gray-200">
                                      <div className="flex-1">
                                        <span className="font-bold text-gray-800">{sizeInfo.size}</span>
                                        <span className="text-sm bg-green-100 text-green-800 px-2 py-1 rounded ml-2">
                                          WSP: ₹{sizeInfo.wsp}
                                        </span>
                                        {currentQty > 0 && (
                                          <div className="text-sm text-blue-600 font-bold mt-1">
                                            Total: ₹{lineTotal.toFixed(2)}
                                          </div>
                                        )}
                                      </div>
                                      <div className="ml-3">
                                        <input
                                          type="number"
                                          min="0"
                                          step="1"
                                          value={currentQty === 0 ? '' : currentQty}
                                          onChange={(e) => {
                                            handleQuantityChange(sizeInfo.childSKU, e.target.value);
                                          }}
                                          className="w-20 p-2 border-2 border-gray-300 rounded-lg text-center focus:ring-2 focus:ring-purple-500 focus:border-transparent transition-all"
                                          placeholder="0"
                                        />
                                      </div>
                                    </div>
                                  );
                                })}
                              </div>
                            </div>
                          </div>
                        </div>
                      ))}
                    </div>

                    {/* Order Summary and Actions */}
                    <div className="bg-white rounded-xl shadow-lg p-6 border border-gray-100">
                      <div className="flex items-center justify-between mb-6">
                        <div className="flex items-center space-x-6">
                          <div className="bg-gradient-to-r from-blue-500 to-blue-600 px-6 py-3 rounded-xl shadow-lg">
                            <div className="flex items-center gap-2">
                              <Package className="w-6 h-6 text-white" />
                              <span className="text-lg font-bold text-white">Total Qty: {totalItems}</span>
                            </div>
                          </div>
                          
                          <div className="bg-gradient-to-r from-green-500 to-green-600 px-6 py-3 rounded-xl shadow-lg">
                            <div className="flex items-center gap-2">
                              <DollarSign className="w-6 h-6 text-white" />
                              <span className="text-lg font-bold text-white">₹{totalValue}</span>
                            </div>
                          </div>
                        </div>
                        
                        <div className="flex gap-3">
                          <button
                            onClick={() => setCurrentStep(2)}
                            className="bg-gradient-to-r from-gray-500 to-gray-600 hover:from-gray-600 hover:to-gray-700 text-white px-6 py-3 rounded-lg font-medium transition-all flex items-center space-x-2"
                          >
                            <ArrowLeft size={16} />
                            <span>Back</span>
                          </button>
                          <button
                            onClick={generateCSV}
                            disabled={totalItems === 0}
                            className={`px-8 py-4 rounded-lg font-bold text-lg transition-all transform hover:scale-105 flex items-center space-x-2 ${
                              totalItems > 0
                                ? 'bg-gradient-to-r from-green-600 to-green-700 hover:from-green-700 hover:to-green-800 text-white shadow-lg'
                                : 'bg-gray-300 text-gray-500 cursor-not-allowed'
                            }`}
                          >
                            <Download size={20} />
                            <span>Download Order ({totalItems} items)</span>
                          </button>
                        </div>
                      </div>
                    </div>
                  </div>
                )}
              </div>
            </div>
          );
        };

        ReactDOM.render(<ProductOrderingApp />, document.getElementById('root'));
    </script>
</body>
</html>
